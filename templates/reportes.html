<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Reportes Avanzados - Soporte Pro</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">

    <nav class="navbar navbar-dark bg-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('home') }}">‚¨Ö Volver al Dashboard</a>
            <span class="navbar-text text-white">Panel de Administraci√≥n</span>
        </div>
    </nav>

    <div class="container">
        <h2 class="mb-4 fw-bold">üìä Estad√≠sticas de Soporte</h2>
        
        <div class="row g-3 mb-4">
            <div class="col-md-4">
                <div class="card text-white bg-primary p-3 shadow-sm border-0">
                    <h5>Total Tickets</h5>
                    <h2 class="display-4 fw-bold">{{ total }}</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-warning p-3 shadow-sm border-0">
                    <h5>Pendientes</h5>
                    <h2 class="display-4 fw-bold">{{ abiertos }}</h2>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-success p-3 shadow-sm border-0">
                    <h5>Resoluci√≥n</h5>
                    <h2 class="display-4 fw-bold">{{ porcentaje }}%</h2>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card border-0 shadow-sm p-4 h-100">
                    <h5 class="mb-3 text-center">Estado de Tickets</h5>
                    <div style="position: relative; height:300px;">
                        <canvas id="myChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card border-0 shadow-sm p-4 h-100">
                    <h5 class="mb-3">üèÜ Top 3 T√©cnicos</h5>
                    <table class="table table-hover mt-2">
                        <thead class="table-light">
                            <tr>
                                <th>Posici√≥n</th>
                                <th>Nombre</th>
                                <th>Cerrados</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for nombre, cantidad in top_tecnicos %}
                            <tr>
                                <td><strong>#{{ loop.index }}</strong></td>
                                <td>{{ nombre }}</td>
                                <td><span class="badge bg-primary px-3">{{ cantidad }}</span></td>
                            </tr>
                            {% else %}
                            <tr><td colspan="3" class="text-center">Sin datos</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Definimos los datos extray√©ndolos de Flask de forma segura para evitar errores en el editor
        const dataAbiertos = parseInt("{{ abiertos }}") || 0;
        const dataCerrados = parseInt("{{ cerrados }}") || 0;

        const ctx = document.getElementById('myChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Pendientes', 'Resueltos'],
                datasets: [{
                    data: [dataAbiertos, dataCerrados],
                    backgroundColor: ['#ffc107', '#198754'],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom' }
                }
            }
        });
    </script>
</body>
</html>